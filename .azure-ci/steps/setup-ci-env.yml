# File: /.azure-ci/steps/setup-ci-env.yml

parameters:
   xcode: 'Xcode_10.2'

steps:

  - bash: |
      printenv
    displayName: Azure printenv

  - bash: |
      set -ex
      sudo xcode-select --switch /Applications/$XCODE_VERSION.app/Contents/Developer
      brew update
      brew cleanup
    displayName: Setup CI Environment
    env:
      XCODE_VERSION: ${{ parameters.xcode }}

  - bash: |
      if [[ -n "$SYSTEM_PULLREQUEST_PULLREQUESTNUMBER" ]]; then
        git fetch origin "master:master" "pull/$SYSTEM_PULLREQUEST_PULLREQUESTNUMBER/head:pr"
        git checkout pr
      fi
    displayName: Checkout $(System.PullRequest.SourceBranch) - pr-$(System.PullRequest.PullRequestNumber) branch
    condition: eq(variables['Build.Reason'], 'PullRequest')
